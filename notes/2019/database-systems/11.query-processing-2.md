# Query Processing 2

## Access Method

DBMS 가 테이블에 저장되어 있는 데이터에 접근할 수 있게 해주는 방법이다.
* 관계 대수학에 정의되어 있지 않다.

기본 접근
* Sequential Scan
* Index Scan
* Multi-Index / "Bitmap" Scan

![](./res/11-1.png)

## Sequential Scan

각 테이블의 페이지마다...
* Buffer pool 로 가져와 데이터를 탐색
* 각 튜플을 반복(Iterate)해가면서 해당 튜플이 포함되어 있는지를 판단

DBMS 는 마지막으로 탐색한 Page / Slot 을 추적하기 위한 내부 커서를 포함하고 있다.

### Optimization

이것은 DBMS 가 쿼리를 실행시키는 상황에서 거의 항상 최악의 경우에 해당한다.

Sequential Scan Optimizations:
* Prefetching
* Parallelization
* Buffer Pool Bypass
* **Zone Maps**
* **Late Materialization**
* **Heap Clustering**

### Zone Maps

페이지의 속성 값들을 위해 미리 값을 계산해놓는다.
DBMS 는 (쿼리를 가져오기 위해) 해당 페이지의 엑세스가 필요한 지를 우선 Zone Map 을 확인하여 결정한다.

![](./res/11-2.png)

원래 데이터를 가진 페이지와 분리된 다른 페이지에 데이터를 계산하여 저장한다.

데이터의 크기가 작기 때문에 Zone Maps 페이지는 여러 페이지의 값을 한 페이지에 몰아서 저장하는 형태로 이루어져 있다.

오라클, DB2 등에 사용되는 개념이다.

### Late Materialization

쿼리 플랜에서 Materialization 이 동작하는 단게의 offset(실행순서) 를 최대한 뒤로 미루어 적은 middle result 로 columns 를 fetch 해올 수 있도록 한다.
(필요한 컬럼을 lazy 하게 fetch 해온다는 개념인 것 같다)

![](./res/11-3.png)

### Heap Clustering

Clustering Index 에 지정된 기준에 따라 heap 의 페이지 내부의 튜플들을 정렬한다.

만약 쿼리가 클러스터링 인덱스를 이용해 튜플에 접근하면, DBMS 는 필요한 페이지를 건너뛰면서 직접 접근할 수 있다.

![](./res/11-4.png)


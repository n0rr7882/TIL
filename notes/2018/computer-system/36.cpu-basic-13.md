# CPU 기초

## 마이크로프로그램

> CPU의 명령어 세트 설계 과정에서
> * 명령어들의 종류와 비트 패턴을 정의하고,
> * 명령어들의 실행에 필요한 하드웨어를 설계하고,
> * 각 명령어 실행을 위한 다양한 마이크로 서브루틴을 작성한 후,
> * 마이크로프로그램 코드들을 제어 기억장치에 저장한다.

* 제어기억장치
    * CPU 마다 종류가 매우 다양하다.
    * ROM으로 구성된다.
    * ROM의 사이즈는 마이크로명령어 형식에 따라 마이크로프로그램의 크기로 결정된다.

### 마이크로명령어 형식

3비트 | 3비트 | 2비트 | 2비트 | 7비트
------|-------|-------|-------|-------
연산1 | 연산2 | 조건  | 분기  | 주소(ADF)

* **연산1, 2 필드**: 이 필드들은 두 개의 마이크로 명령어들이 동시에 실행될 수 있다는 것을 의미한다.
* **조건 필드**: 분기 필드에서 사용될 조건을 명시한다.
* **분기 필드**: 분기의 종류를 명시하고, 조건에 따라 다음에 실행될 마이크로 명령어의 주소 결정방법을 명시한다.
* **주소 필드**: 조건에 따라 분기가 발생하는 경우에 분기의 목적지 주소로 이동한다.

### 마이크로명령어의 이진코드와 기호

* 연산1 필드에 위치할 마이크로-연산

    코드 | 마이크로-연산 | 기호
    -----|---------------|-----
    000 | None | NONE
    001 | MAR <- PC | PCTAR
    010 | MAR <- IR(addr) | IRTAR
    011 | AC <- AC + MDR | ADD
    100 | MDR <- M[MAR] | READ
    101 | AC <- MDR | DRTAC
    110 | IR <- MDR | DRTIR
    111 | M[MAR] <- MDR | WRITE

* 연산2 필드에 위치할 마이크로-연산

    코드 | 마이크로-연산 | 기호
    -----|---------------|-----
    000 | None | NONE
    001 | PC <- PC + 1 | INCPC
    010 | MDR <- AC | ACTAR
    011 | MDR <- PC | PCTAR
    100 | PC <- MDR | DRTPC
    101 | MAR <- SP | SPTAR
    110 | AC <- AC - MDR | SUB
    111 | PC <- IR(addr) | IRTPC

* 조건 필드에 위치할 마이크로-연산

    코드 | 조건 | 기호 | 설명
    -----|------|------|-----
    00 | 1 | U | 무조건 분기
    01 | i bit | I | 간접 주소 지정
    10 | AC(S) | S | 누산기(AC)에 저장된 데이터의 부호
    11 | AC=0 | Z | AC에 저장된 데이터 = 0

* 분기 필드에 위치할 마이크로-연산

    코드 | 기호 | 설명
    -----|------|-----
    00 | JMP | `조건=1` 이면 CAR <- ADF<br/>`조건=0` 이면 CAR <- CAR + 1
    01 | CALL |`조건=1` 이면 CAR <- ADF, SBR <- CAR + 1<br/>`조건=0` 이면 CAR <- CAR + 1
    10 | RET | CAR <- SBR (서브루틴으로부터의 복귀)
    11 | MAP | CAR<sub>6</sub> <- '1', CAR<sub>5~2</sub> <- IR(op-code), CAR<sub>1~0</sub> <- '0'

    * 실행 사이클의 마이크로서브루틴을 찾기 위한 사상(Mapping) 방법

        * 명령어 내의 op-code가 지정하는 연산을 실행하기 위하여 제어기억장치 내에 실행 사이클의 마이크로서브루틴이 프로그램 되어있는 **시작 주소를 찾아가는 방법**이다.
        * 명령어 op-code의 비트를 **사상함수의 특정 비트 패턴과 조합**하는 방법이다.

    * 사상(Mapping)방법에 따른 실행 사이클의 마이크로서브루틴 주소

        Instruction | op-code | 마이크로서브루틴의 주소
        ------------|---------|------------------------
        NOP | 0 0 0 0 | f(0 0 0 0) = 1 0 0 0 0 0 0 = 64<sub>10</sub>
        LOAD | 0 0 0 1 | f(0 0 0 1) = 1 0 0 0 1 0 0 = 68<sub>10</sub>
        STORE | 0 0 1 0 | f(0 0 1 0) = 1 0 0 1 0 0 0 = 72<sub>10</sub>
        ADD | 0 0 1 1 | f(0 0 1 1) = 1 0 0 1 1 0 0 = 76<sub>10</sub>
        SUB | 0 1 0 0 | f(0 1 0 0) = 1 0 1 0 0 0 0 = 80<sub>10</sub>
        JUMP | 0 1 0 1 | f(0 1 0 1) = 1 0 1 0 1 0 0 = 84<sub>10</sub>
